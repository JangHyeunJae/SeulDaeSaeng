<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">

	<resultMap type="memVO" id="memMap">
		<result property="usersNo" column="USERS_NO"/>
		<result property="memName" column="MEM_NAME"/>
		<result property="memNick" column="MEM_NICK"/>
		<result property="memBirth" column="MEM_BIRTH"/>
		<result property="memEmail" column="MEM_EMAIL"/>
		<result property="memTel" column="MEM_TEL"/>
		<result property="memClass" column="MEM_CLASS"/>
		<result property="memRegdt" column="MEM_REGDT"/>
		<result property="addrNo" column="ADDR_NO"/>
		<result column="users_id" property="usersId" />
		<result column="users_pass" property="usersPass" />
		<result column="mem_addr" property="memAddr" />
		<result column="atch_file_id" property="atchFileId" />
		<result column="reg_dt" property="regDt" />
	</resultMap>
	
	<resultMap type="usersVO" id="usersMap">
		<result property="usersNo" column="USERS_NO"/>
		<result property="usersRole" column="USERS_ROLE"/>
		<result property="usersId" column="USERS_ID"/>
		<result property="usersPass" column="USERS_PASS"/>
		<result property="usersYn" column="USERS_YN"/>
	</resultMap>
	
	<resultMap type="addrVO" id="addrMap">
		<result property="addrNo" column="ADDR_NO"/>
		<result property="addrPost" column="ADDR_POST"/>
		<result property="addrBasic" column="ADDR_BASIC"/>
		<result property="addrDetail" column="ADDR_DETAIL"/>
		<result property="addrLon" column="ADDR_LON"/>
		<result property="addrLat" column="ADDR_LAT"/>
		<result property="addrLevel" column="ADDR_LEVEL"/>
	</resultMap>

	<select id="memberIdChk" parameterType="String" resultType="int">
		select count(*) as cnt from users where USERS_ID = #{usersId}
	</select>

	<select id="loginCheck" resultMap="memMap" parameterType="memVO">
		select*
		from users
		where users_id = #{usersId}
		and users_pass = #{usersPass}
		and users_yn = 'Y'
	</select>

	<insert id="usersJoin" parameterType="usersVO">
		<selectKey keyProperty="usersNo" resultType="int" order="BEFORE">
			select SEQ_USERS_NO.nextval as usersNo from dual
		</selectKey>
		INSERT INTO USERS(USERS_NO, USERS_ROLE, USERS_ID, USERS_PASS, USERS_YN)
		VALUES(#{usersNo}, #{usersRole}, #{usersId}, #{usersPass}, #{usersYn})
	</insert>

	<insert id="addrJoin" parameterType="addrVO">
		<selectKey keyProperty="addrNo" resultType="int" order="BEFORE">
			select SEQ_ADDR.nextval as addrNo from dual
		</selectKey>
			INSERT INTO ADDRESS(ADDR_NO, ADDR_POST, ADDR_BASIC, ADDR_DETAIL, ADDR_LEVEL)
		    VALUES(#{addrNo}, #{addrPost}, #{addrBasic}, #{addrDetail}, #{addrLevel})
	</insert>

	<insert id="memberJoin" parameterType="memVO">
 		<selectKey keyProperty="usersNo,addrNo" resultType="memVO" order="BEFORE">
			select SEQ_USERS_NO.currval as usersNo, SEQ_ADDR.currval as addrNo from dual
		</selectKey>
		 	INSERT INTO MEMBER(USERS_NO, MEM_NAME, MEM_NICK, MEM_BIRTH, MEM_EMAIL, MEM_TEL, MEM_CLASS, ADDR_NO)
		    VALUES(#{usersNo}, #{memName}, #{memNick}, #{memBirth}, #{memEmail}, #{memTel}, #{memClass}, #{addrNo})
	</insert>
	
	<select id="selectUsers" parameterType="String" resultMap="usersMap">
		select * from USERS where USERS_ID = #{usersId}
	</select>
	
	<select id="selectMember" parameterType="int" resultMap="memMap">
		select * from MEMBER where USERS_NO = #{usersNo}
	</select>
	
	<select id="selectAddr" parameterType="int" resultMap="addrMap">
		select * from ADDRESS where ADDR_NO = #{addrNo}
	</select>
	
</mapper>